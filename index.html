<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Proposta de Bolsas - Grau Educacional PROGRESSIVO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" href="imagens/favicon1.png" type="imagens/favicon1.png">
  <style>
    body {
      background: #fff;
      min-height: 100vh;
    }

    .login-glass {
      background: rgba(255, 255, 255, 0.92);
      box-shadow: 0 8px 40px 0 rgba(16, 185, 129, 0.10), 0 1.5px 8px 0 rgba(0, 0, 0, 0.08);
      border: 1.5px solid #e5e7eb;
    }

    .login-input:focus {
      border-color: #16a34a;
      box-shadow: 0 0 0 1.5px #16a34a44;
    }

    .gradient-bg {
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
    }

    .card-shadow {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    textarea {
      resize: none;
    }

    .valor-riscado {
      text-decoration: line-through;
      color: #e11d48;
    }

    .valor-cheio-toggle {
      display: none;
    }

    .mostrar-valor-cheio .valor-cheio-toggle {
      display: inline;
    }

    @media (max-width: 600px) {
      #videoModal video {
        max-width: 98vw !important;
        max-height: 40vh !important;
      }

      #videoModal>div {
        padding: 8px 2vw 16px 2vw !important;
      }

      .cursos-icones {
        gap: 0.5rem !important;
      }
    }
  </style>
</head>

<body class="bg-white min-h-screen">
  <!-- Login Modal NOVO LAYOUT -->
  <div id="loginModal" class="fixed inset-0 z-50 flex items-center justify-center min-h-screen bg-gray-100">
    <div class="login-glass p-8 rounded-2xl max-w-md w-full shadow-xl flex flex-col items-center relative">
      <!-- Logo do Grau Educacional -->
      <div class="flex flex-col items-center mb-7 w-full">
        <img src="imagens/grau.png" alt="Grau Educacional"
          class="h-16 sm:h-20 w-auto bg-white rounded-xl shadow-lg p-2 mb-2">
        <h2 class="text-2xl font-extrabold text-gray-900 tracking-tight mt-2">Sistema de Proposta de Bolsas</h2>
        <p class="text-green-900 text-xs font-semibold">Acesso interno</p>
      </div>
      <form id="loginForm" autocomplete="off" class="w-full">
        <div class="mb-4">
          <label class="block text-gray-700 font-semibold mb-2" for="loginUser">
            <i class="fa fa-user mr-1 text-green-700"></i> Usuário
          </label>
          <input id="loginUser" type="text" autocomplete="username"
            class="login-input w-full border border-gray-300 rounded-lg px-4 py-2 text-base focus:outline-none transition focus:ring-2 focus:ring-green-500"
            required="">
        </div>
        <div class="mb-6">
          <label class="block text-gray-700 font-semibold mb-2" for="loginPass">
            <i class="fa fa-lock mr-1 text-green-700"></i> Senha
          </label>
          <input id="loginPass" type="password" autocomplete="current-password"
            class="login-input w-full border border-gray-300 rounded-lg px-4 py-2 text-base focus:outline-none transition focus:ring-2 focus:ring-green-500"
            required="">
        </div>
        <button type="submit"
          class="w-full py-2 px-4 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold rounded-lg shadow-lg transition-colors text-lg flex items-center justify-center gap-2">
          <i class="fas fa-arrow-right"></i>
          Entrar
        </button>
        <div id="loginError" class="text-red-600 font-semibold mt-4 text-center hidden"></div>
      </form>
      <div class="absolute bottom-4 left-0 w-full flex justify-center opacity-70">
        <small class="text-gray-600">
          © Grau Educacional - Sistema de Proposta de Bolsas
        </small>
      </div>
    </div>
  </div>
  <!-- Main Content -->
  <div id="mainApp" style="display:none;">
    <div class="container mx-auto px-2 sm:px-4 py-8">
      <div class="max-w-5xl mx-auto">
        <div
          class="gradient-bg text-white rounded-t-xl p-6 flex flex-col sm:flex-row items-center justify-between gap-4">
          <div class="flex-1 flex items-center gap-4">
            <img src="imagens/grau.png" alt="Logo Grau Educacional"
              class="h-16 w-auto bg-white rounded-lg p-1 shadow-md">
            <div>
              <h1 class="text-3xl font-bold text-white">Grau Educacional</h1>
              <p class="text-green-100">Sistema de Proposta de Bolsas</p>
              <div class="flex gap-2">
                <button onclick="abrirVideo('videos/enfermagem.mp4', 'Enfermagem')"
                  class="flex flex-col items-center hover:bg-green-200 bg-white/90 rounded-lg px-3 py-2 focus:outline-none transition">
                  <span class="text-xs font-semibold text-green-900">Enfermagem</span>
                </button>
                <button onclick="abrirVideo('videos/radiologia.mp4', 'Radiologia')"
                  class="flex flex-col items-center hover:bg-green-200 bg-white/90 rounded-lg px-3 py-2 focus:outline-none transition">
                  <span class="text-xs font-semibold text-green-900">Radiologia</span>
                </button>
                <button onclick="abrirVideo('videos/informatica.mp4', 'Informática')"
                  class="flex flex-col items-center hover:bg-green-200 bg-white/90 rounded-lg px-3 py-2 focus:outline-none transition">
                  <span class="text-xs font-semibold text-green-900">Informática</span>
                </button>
                <button onclick="abrirVideo('videos/administracao.mp4', 'Administração')"
                  class="flex flex-col items-center hover:bg-green-200 bg-white/90 rounded-lg px-3 py-2 focus:outline-none transition">
                  <span class="text-xs font-semibold text-green-900">Administração</span>
                </button>
              </div>
              </button>
            </div>
          </div>
        </div>
        <!-- Fim dos ícones dos cursos -->

        <div class="bg-white p-8 rounded-b-xl card-shadow fade-in">
          <div id="planilhaStatus" class="mb-6">
            <div class="flex items-center gap-2 text-blue-600 font-semibold">
              <i class="fas fa-spinner fa-spin"></i>
              Carregando planilha do servidor...
            </div>
          </div>
          <form id="formDesconto" onsubmit="event.preventDefault(); mostrarInfoTurma();">
            <div class="mb-4">
              <label for="numeroCliente" class="block font-semibold mb-1">Número do Cliente:</label>
              <input type="text" id="numeroCliente" class="w-full border rounded px-3 py-2"
                placeholder="Digite o número do cliente" pattern="\d*" inputmode="numeric">
            </div>
            <div class="mb-4">
              <label for="nomeCliente" class="block font-semibold mb-1">Nome do Cliente:</label>
              <input type="text" id="nomeCliente" class="w-full border rounded px-3 py-2"
                placeholder="Digite o nome do cliente" maxlength="100">
            </div>
            <div class="mb-4">
              <label for="curso" class="block font-semibold mb-1">Escolha o curso:</label>
              <select id="curso" class="w-full border rounded px-3 py-2"></select>
            </div>
            <div class="mb-4">
              <label for="turno" class="block font-semibold mb-1">Escolha o turno:</label>
              <select id="turno" class="w-full border rounded px-3 py-2"></select>
            </div>
            <div class="mb-4" id="turmaContainer" style="display: none;">
              <label for="turma" class="block font-semibold mb-1">Escolha a turma:</label>
              <select id="turma" class="w-full border rounded px-3 py-2"></select>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
              <button type="submit" id="btnTurma"
                class="bg-green-700 hover:bg-green-800 text-white font-semibold rounded px-6 py-2 transition-colors duration-200">
                Consultar Turma
              </button>
              <button type="button" onclick="limparFormulario()"
                class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold rounded px-6 py-2 transition-colors duration-200 flex items-center gap-2">
                <i class="fas fa-broom"></i> Limpar
              </button>
            </div>
            <div id="resultado" class="mb-4" role="region" aria-live="polite"></div>
            <div id="areaDesconto"></div>
          </form>
          <div id="timer" class="text-center text-red-600 font-semibold mt-6"></div>
        </div>
        <div id="printArea" class="hidden"></div>
      </div>
    </div>
  </div>

  <!-- Modal do player de vídeo -->
  <div id="videoModal"
    style="display:none; position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:9999;align-items:center;justify-content:center;"
    class="flex">
    <div
      style="background:white;padding:16px 24px 24px 24px;border-radius:16px;max-width:94vw;max-height:90vh;position:relative;">
      <button onclick="fecharVideo()" style="position:absolute;top:8px;right:14px;font-size:2em;color:#e11d48;"
        aria-label="Fechar">
        <i class="fas fa-times"></i>
      </button>
      <div class="mb-2 font-bold text-lg text-green-800 text-center" id="nomeCursoVideo"></div>
      <video id="videoPlayer" controls="" style="max-width:80vw;max-height:70vh;border-radius:12px;">
        <source src="" type="video/mp4">
        Seu navegador não suporta vídeo.
      </video>
    </div>
  </div>

  <script>
    // ---- Player de vídeo dos cursos
    function abrirVideo(src, nomeCurso) {
      document.getElementById('videoPlayer').src = src;
      document.getElementById('nomeCursoVideo').textContent = nomeCurso;
      document.getElementById('videoModal').style.display = 'flex';
      document.getElementById('videoPlayer').play();
    }
    function fecharVideo() {
      document.getElementById('videoModal').style.display = 'none';
      document.getElementById('videoPlayer').pause();
      document.getElementById('videoPlayer').src = '';
      document.getElementById('nomeCursoVideo').textContent = '';
    }
    document.addEventListener('click', function (e) {
      const modal = document.getElementById('videoModal');
      if (modal && modal.style.display === 'flex' && e.target === modal) {
        fecharVideo();
      }
    });
    // ---- Fim do player dos cursos

    // ---- O resto do seu JS original (a partir daqui, exatamente igual ao seu código original, sem cortes)
    let usuariosAutorizados = [];
    let usuarioLogado = null;

    let turmasPlanilha = [];
    let precosPlanilha = [];
    let countdownInterval, lastResumoTexto = '', lastResumoHTML = '', resumoDataFim = null,
      resumoDiasAula = '', resumoInicioTurma = '', resumoDesconto = 0,
      resumoParcelasProgressivas = [], resumoParcelasAgrupadas = [],
      resumoValorCheio = 0, resumoParcelas = 0, resumoValorParcela = 0,
      resumoDescontoStr = "", resumoValorFinal = 0,
      resumoAlertaProgressivo = "", resumoPlanoProgressivoOk = false,
      resumoHorario = '', turmaSelecionadaGlobal = null;

    let cursosDisponiveis = [], turnosDisponiveis = [];
    let planilhaOk = false;

    function excelDateToString(excelDate) {
      if (!excelDate) return '-';
      if (typeof excelDate === "string" && excelDate.match(/^\d{4}-\d{2}-\d{2}/)) {
        const [y, m, d] = excelDate.split('-');
        return `${d}/${m}/${y}`;
      }
      if (typeof excelDate === "number") {
        const date = new Date(Math.round((excelDate - 25569) * 86400 * 1000));
        const d = String(date.getUTCDate()).padStart(2, '0');
        const m = String(date.getUTCMonth() + 1).padStart(2, '0');
        const y = date.getUTCFullYear();
        return `${d}/${m}/${y}`;
      }
      return excelDate;
    }

    window.addEventListener("DOMContentLoaded", function () {
      carregarPlanilhaServidor();
    });

    function carregarPlanilhaServidor() {
      const planilhaStatus = document.getElementById('planilhaStatus');
      planilhaStatus.innerHTML = `<div class="flex items-center gap-2 text-blue-600 font-semibold"><i class="fas fa-spinner fa-spin"></i> Carregando planilha do servidor...</div>`;
      fetch('dados.xlsx')
        .then(resp => {
          if (!resp.ok) throw new Error("Erro ao baixar a planilha");
          return resp.arrayBuffer();
        })
        .then(arrayBuffer => {
          const data = new Uint8Array(arrayBuffer);
          const workbook = XLSX.read(data, { type: 'array' });
          const sheetTurmas = workbook.Sheets['Turmas'];
          if (!sheetTurmas) {
            planilhaStatus.innerHTML = `<div class="text-red-700"><i class="fas fa-exclamation-triangle"></i> Planilha não contém aba 'Turmas'!</div>`;
            return;
          }
          const linhasTurmas = XLSX.utils.sheet_to_json(sheetTurmas, { defval: '' });
          turmasPlanilha = [];
          linhasTurmas.forEach(linha => {
            let existe = turmasPlanilha.find(t =>
              t.curso === linha.Curso &&
              t.turno === linha.Turno &&
              t.turma === linha.Turma
            );
            if (!existe) {
              turmasPlanilha.push({
                curso: linha.Curso,
                turno: linha.Turno,
                turma: linha.Turma,
                dias: linha.Dias,
                horario: (linha.Horario || linha['Horario'] || linha['horario'] || '').toString().trim(),
                disciplinas: []
              });
            }
            existe = turmasPlanilha.find(t =>
              t.curso === linha.Curso &&
              t.turno === linha.Turno &&
              t.turma === linha.Turma
            );
            existe.disciplinas.push({
              inicio: linha.DataInicio,
              nro: linha.DisciplinaNro,
              nome: linha.DisciplinaNome
            });
          });
          const sheetPrecos = workbook.Sheets['Precos'];
          if (!sheetPrecos) {
            planilhaStatus.innerHTML = `<div class="text-red-700"><i class="fas fa-exclamation-triangle"></i> Planilha não contém aba 'Precos'!</div>`;
            return;
          }
          precosPlanilha = XLSX.utils.sheet_to_json(sheetPrecos, { defval: '' });
          cursosDisponiveis = [...new Set(turmasPlanilha.map(t => t.curso))];

          const sheetAcesso = workbook.Sheets['Acesso'];
          if (!sheetAcesso) {
            planilhaStatus.innerHTML = `<div class="text-red-700"><i class="fas fa-exclamation-triangle"></i> Planilha não contém aba 'Acesso'!</div>`;
            return;
          }
          usuariosAutorizados = XLSX.utils.sheet_to_json(sheetAcesso, { defval: '' });
          preencherCursos();
          planilhaOk = true;
          planilhaStatus.innerHTML = `<div class="flex items-center gap-2 text-green-700 font-semibold"><i class="fas fa-check-circle"></i> Planilha carregada automaticamente!</div>`;
          setTimeout(() => planilhaStatus.style.display = "none", 2000);
        })
        .catch(e => {
          planilhaStatus.innerHTML = `<div class="text-red-700"><i class="fas fa-exclamation-triangle"></i> Falha ao carregar planilha: ${e.message}</div>`;
        });
    }

    function preencherCursos() {
      const cursoSel = document.getElementById('curso');
      cursoSel.innerHTML = '';
      cursosDisponiveis.forEach(curso => {
        const option = document.createElement('option');
        option.value = curso;
        option.textContent = curso;
        cursoSel.appendChild(option);
      });
      preencherTurnos();
      cursoSel.onchange = preencherTurnos;
    }

    function preencherTurnos() {
      const turnoSel = document.getElementById('turno');
      const cursoSel = document.getElementById('curso');
      const curso = cursoSel.value;
      const turnos = turmasPlanilha.filter(t => t.curso === curso).map(t => t.turno);
      turnosDisponiveis = [...new Set(turnos)];
      turnoSel.innerHTML = '';
      turnosDisponiveis.forEach(turno => {
        const option = document.createElement('option');
        option.value = turno;
        option.textContent = turno;
        turnoSel.appendChild(option);
      });
      // Limpa campo turma ao trocar turno/curso
      document.getElementById('turmaContainer').style.display = "none";
    }

    document.getElementById('loginForm').onsubmit = function (e) {
      e.preventDefault();
      const user = document.getElementById('loginUser').value.trim();
      const pass = document.getElementById('loginPass').value;
      if (!usuariosAutorizados.length) {
        document.getElementById('loginError').textContent = "Planilha de acesso ainda não carregada!";
        document.getElementById('loginError').classList.remove('hidden');
        return;
      }
      const achou = usuariosAutorizados.find(u =>
        String(u.usuario).trim() === user && String(u.senha) === pass
      );
      if (achou) {
        usuarioLogado = achou;
        document.getElementById('loginModal').style.display = 'none';
        document.getElementById('mainApp').style.display = '';
      } else {
        document.getElementById('loginError').textContent = "Usuário ou senha inválidos!";
        document.getElementById('loginError').classList.remove('hidden');
      }
    };

    function mostrarInfoTurma() {
      const numeroCliente = document.getElementById("numeroCliente").value.trim();
      const nomeCliente = document.getElementById("nomeCliente").value.trim();
      const turnoSelecionado = document.getElementById("turno").value;
      const cursoSelecionado = document.getElementById("curso").value;
      const resultadoDiv = document.getElementById("resultado");
      const areaDesconto = document.getElementById("areaDesconto");
      const turmaContainer = document.getElementById("turmaContainer");
      const turmaSelect = document.getElementById("turma");

      resultadoDiv.innerHTML = "";
      document.getElementById("timer").innerHTML = "";
      clearInterval(countdownInterval);
      areaDesconto.innerHTML = "";
      turmaContainer.style.display = "none";

      if (!numeroCliente || !nomeCliente) {
        resultadoDiv.innerHTML = `
      <div class="flex items-center gap-2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        Por favor, preencha todos os campos obrigatórios.
      </div>`;
        return;
      }
      if (!/^\d+$/.test(numeroCliente)) {
        resultadoDiv.innerHTML = `
      <div class="flex items-center gap-2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        O número do cliente deve conter apenas dígitos.
      </div>`;
        return;
      }

      const turmas = turmasPlanilha.filter(item =>
        item.curso === cursoSelecionado && item.turno === turnoSelecionado
      );

      if (!turmas.length) {
        resultadoDiv.innerHTML = `
      <div class="flex items-center gap-2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        Não há turma disponível para essa combinação de curso e turno.
      </div>`;
        return;
      }

      if (turmas.length === 1) {
        turmaContainer.style.display = "none";
        turmaSelecionadaGlobal = turmas[0];
        exibirResumoTurma(turmas[0]);
      } else {
        turmaSelect.innerHTML = "";
        turmas.forEach((turma, idx) => {
          const option = document.createElement('option');
          option.value = idx;
          let inicio = "-";
          if (turma.disciplinas && turma.disciplinas[0]) {
            inicio = excelDateToString(turma.disciplinas[0].inicio);
          }
          option.textContent = `${turma.turma} - Início: ${inicio}`;
          turmaSelect.appendChild(option);
        });
        turmaContainer.style.display = "block";
        resultadoDiv.innerHTML = `
      <div class="flex items-center gap-2 bg-yellow-50 border border-yellow-400 text-yellow-700 px-4 py-3 rounded font-semibold" role="status">
        <i class="fas fa-info-circle"></i>
        Selecione a turma desejada acima para visualizar as informações e gerar a proposta.
      </div>
    `;
        areaDesconto.innerHTML = '';
        turmaSelecionadaGlobal = null;
        turmaSelect.onchange = function () {
          turmaSelecionadaGlobal = turmas[Number(turmaSelect.value)];
          exibirResumoTurma(turmaSelecionadaGlobal);
        };
      }

      function exibirResumoTurma(turmaInfo) {
        resumoDiasAula = turmaInfo.dias;

        function parseDisciplinaData(inicio) {
          if (typeof inicio === "number") {
            return new Date(Math.round((inicio - 25569) * 86400 * 1000));
          }
          if (typeof inicio === "string" && /^\d{4}-\d{2}-\d{2}/.test(inicio)) {
            return new Date(inicio);
          }
          if (typeof inicio === "string" && /^\d{2}\/\d{2}\/\d{4}/.test(inicio)) {
            const [d, m, y] = inicio.split('/');
            return new Date(`${y}-${m}-${d}`);
          }
          return null;
        }
        let inicioDisciplina = "-";
        if (turmaInfo.disciplinas.length > 0) {
          const agora = new Date();
          agora.setHours(0, 0, 0, 0);
          let proxima = turmaInfo.disciplinas.find(d => {
            const dt = parseDisciplinaData(d.inicio);
            return dt && dt >= agora;
          });
          if (!proxima) {
            proxima = turmaInfo.disciplinas[turmaInfo.disciplinas.length - 1];
          }
          inicioDisciplina = proxima ? excelDateToString(proxima.inicio) : "-";
        }
        resumoInicioTurma = inicioDisciplina;
        resumoHorario = turmaInfo.horario || '-';

        let htmlDisciplinas = `
      <table class="w-full mt-3 text-sm">
        <thead>
          <tr class="bg-blue-50">
            <th class="py-2 px-2 text-left font-bold">Início</th>
            <th class="py-2 px-2 text-left font-bold">Disciplina</th>
          </tr>
        </thead>
        <tbody>
          ${turmaInfo.disciplinas.map(d => `
            <tr>
              <td class="py-1 px-2">${excelDateToString(d.inicio)}</td>
              <td class="py-1 px-2">${d.nro} - ${d.nome}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;

        resultadoDiv.innerHTML = `
      <div class="flex items-center gap-2 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded font-semibold" role="status">
        <i class="fas fa-check-circle"></i>
        Informações da turma localizada!
      </div>
      <div class="mt-3">
        <strong>Informações da turma:</strong><br>
        <b>Turma:</b> ${turmaInfo.turma} <br>
        <b>Início da turma:</b> ${resumoInicioTurma ? resumoInicioTurma : '-'} <br>
        <b>Horário:</b> ${turmaInfo.horario || '-'} <br>
        <b>Dias de aula:</b> ${resumoDiasAula} <br>
        <b>Cronograma de disciplinas:</b> ${htmlDisciplinas}
      </div>
    `;

        areaDesconto.innerHTML = `
      <div class="mt-4">
        <label for="desconto" class="font-semibold mb-1 block">Escolha o desconto:</label>
        <select id="desconto" onchange="mostrarCampoSenha()" class="w-full border rounded px-3 py-2 mb-2">
          <option value="10">10%</option>
          <option value="15">15%</option>
          <option value="20">20%</option>
          <option value="25">25%</option>
          <option value="30">30%</option>
        </select>
      </div>
      <div id="senhaContainer" style="display:none;" class="mt-2">
        <label for="senhaCoordenador" class="font-semibold mb-1 block">Senha do Coordenador:</label>
        <input type="password" id="senhaCoordenador" class="w-full border rounded px-3 py-2" placeholder="Digite a senha do coordenador" />
      </div>
      <button type="button" class="bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded px-6 py-2 w-full mt-4 transition-colors duration-200" onclick="mostrarDelayBolsa()">Gerar Bolsa de Desconto</button>
    `;
      }
    }

    function mostrarCampoSenha() {
      const descontoSelecionado = document.getElementById("desconto").value;
      const senhaDiv = document.getElementById("senhaContainer");
      if (descontoSelecionado === "25" || descontoSelecionado === "30") {
        senhaDiv.style.display = "block";
      } else {
        senhaDiv.style.display = "none";
      }
    }
    function mostrarDelayBolsa() {
      const descontoSelect = document.getElementById("desconto");
      const descontoValor = descontoSelect ? descontoSelect.value : "10";
      const senhaCoordenadorInput = document.getElementById("senhaCoordenador");
      const senhaValor = senhaCoordenadorInput ? senhaCoordenadorInput.value : "";
      const resultadoDiv = document.getElementById("resultado");
      const areaDesconto = document.getElementById("areaDesconto");
      areaDesconto.innerHTML = "";
      resultadoDiv.innerHTML += `
        <div class="flex items-center gap-2 text-blue-600 font-semibold mt-2">
          <i class="fas fa-spinner fa-spin"></i>
          Conectando aos servidores...
        </div>
      `;
      setTimeout(() => {
        resultadoDiv.innerHTML = resultadoDiv.innerHTML.replace(/<div class="flex items-center gap-2 text-blue-600 font-semibold mt-2">[\s\S]*?<\/div>/, "");
        gerarBolsaDesconto(descontoValor, senhaValor);
      }, 1500);
    }

    // MODIFICADO: utiliza turmaSelecionadaGlobal (definida na seleção)
    function gerarBolsaDesconto(descontoStr, senhaCoordenador) {
      const numeroCliente = document.getElementById("numeroCliente").value.trim();
      const nomeCliente = document.getElementById("nomeCliente").value.trim();
      const turnoSelecionado = document.getElementById("turno").value;
      const cursoSelecionado = document.getElementById("curso").value;
      const desconto = parseFloat(descontoStr) / 100;
      resumoDesconto = desconto;
      resumoDescontoStr = descontoStr;

      const resultadoDiv = document.getElementById("resultado");
      const areaDesconto = document.getElementById("areaDesconto");

      // Pega a turma correta
      let turmaInfo = turmaSelecionadaGlobal;
      if (!turmaInfo) {
        // fallback: busca primeira turma
        const turmas = turmasPlanilha.filter(item =>
          item.curso === cursoSelecionado && item.turno === turnoSelecionado
        );
        turmaInfo = turmas[0];
      }

      // Pega preço e parcelas da aba Precos
      const precoObj = precosPlanilha.find(p =>
        p.Curso === cursoSelecionado && p.Turno === turnoSelecionado
      );
      if (!precoObj) {
        resultadoDiv.innerHTML += `
          <div class="flex items-center gap-2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mt-2" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            Não foi encontrado preço para este curso/turno na aba Precos!
          </div>`;
        areaDesconto.innerHTML = "";
        return;
      }
      let valorCheio = Math.round((Number(precoObj.ValorCheio) || 0) * 100) / 100;
      let parcelas = Number(precoObj.Parcelas) || 1;
      let valorParcela = Math.round((valorCheio / parcelas) * 100) / 100;
      let valorFinal = Math.round((valorCheio * (1 - desconto)) * 100) / 100;
      let valorParcelaDesconto = Math.round((valorFinal / parcelas) * 100) / 100;
      let valorDescontoTotal = Math.round((valorCheio - valorFinal) * 100) / 100;

      resumoValorCheio = valorCheio;
      resumoParcelas = parcelas;
      resumoValorParcela = valorParcela;
      resumoValorFinal = valorFinal;
      resumoAlertaProgressivo = "";
      resumoPlanoProgressivoOk = false;

      function senhaCoordenadorValida(senhaDigitada) {
        return usuariosAutorizados.some(u =>
          u.cargo && u.cargo.toLowerCase().includes('coordenador') &&
          String(u.senha).trim() === senhaDigitada.trim()
        );
      }

      if ((descontoStr === "25" || descontoStr === "30") && !senhaCoordenadorValida(senhaCoordenador)) {
        resultadoDiv.innerHTML += `
    <div class="flex items-center gap-2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mt-2" role="alert">
      <i class="fas fa-lock"></i>
      Senha do Coordenador incorreta.
    </div>`;
        areaDesconto.innerHTML = "";
        return;
      }

      resumoParcelasProgressivas = [];
      resumoParcelasAgrupadas = [];
      let totalParcelasProgressivo = 0;
      if (precoObj.PlanoProgressivo) {
        let planoProgressivo = String(precoObj.PlanoProgressivo)
          .split(';')
          .map(parte => {
            const [qtd, valor] = parte.split(':');
            return {
              qtd: parseInt(qtd.trim()),
              valor: parseFloat(valor.replace(',', '.'))
            };
          });
        let pos = 1;
        planoProgressivo.forEach(grupo => {
          resumoParcelasAgrupadas.push({
            de: pos,
            ate: pos + grupo.qtd - 1,
            valorCheio: grupo.valor,
            valorDesconto: Math.round(grupo.valor * (1 - desconto) * 100) / 100
          });
          pos += grupo.qtd;
        });

        planoProgressivo.forEach(grupo => {
          totalParcelasProgressivo += grupo.qtd;
          for (let i = 0; i < grupo.qtd; i++) {
            resumoParcelasProgressivas.push({
              valorCheio: grupo.valor,
              valorDesconto: Math.round(grupo.valor * (1 - desconto) * 100) / 100
            });
          }
        });

        if (totalParcelasProgressivo !== parcelas) {
          resumoAlertaProgressivo = `
            <div style="color:#b91c1c;background:#fee2e2;padding:10px;border-radius:6px;margin:8px 0;font-weight:bold;">
              <i class="fas fa-exclamation-triangle"></i>
              Atenção: total de parcelas do plano progressivo (${totalParcelasProgressivo}) <u>não confere</u> com o número total de parcelas (${parcelas}) da planilha! O plano progressivo não será exibido.
            </div>
          `;
          resumoParcelasAgrupadas = [];
          resumoParcelasProgressivas = [];
        } else {
          resumoPlanoProgressivoOk = true;
        }
      }

      const agora = new Date();
      const dataFim = new Date(agora.getTime() + 6 * 60 * 60 * 1000);
      resumoDataFim = dataFim;

      function formatarDataHoraBR(date) {
        const d = String(date.getDate()).padStart(2, '0');
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const y = date.getFullYear();
        const h = String(date.getHours()).padStart(2, '0');
        const min = String(date.getMinutes()).padStart(2, '0');
        return `${d}/${m}/${y} às ${h}:${min}`;
      }
      const dataEncerramentoBR = formatarDataHoraBR(dataFim);

      let resumoParcelamentoFixo = `
        <div style="margin-bottom:8px;">
          <b>Parcelamento fixo:</b><br>
          <span style="color:#166534;font-weight:600">${parcelas}x</span> de <span style="color:#166534;font-weight:bold">R$ ${valorParcelaDesconto.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span> (com desconto)<br>
          <span style="font-size:0.95em;color:#666;">Valor cheio de cada parcela: <span style="text-decoration:line-through;color:#e11d48;">R$ ${valorParcela.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span></span>
        </div>
      `;
      let tabelaParcelasAgrupadaHTML = "";
      if (resumoParcelasAgrupadas.length > 0 && resumoPlanoProgressivoOk) {
        tabelaParcelasAgrupadaHTML = `
        <div style="margin:12px 0 4px 0;"><b>Ou Plano progressivo:</b></div>
        <table style="width:100%;margin-bottom:4px;border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:left;padding:2px 4px;">Parcelas</th>
              <th style="text-align:right;padding:2px 4px;">Valor cheio</th>
              <th style="text-align:right;padding:2px 4px;">Com desconto</th>
            </tr>
          </thead>
          <tbody>
            ${resumoParcelasAgrupadas.map(grupo => `
              <tr>
                <td style="padding:2px 4px;">${grupo.de}ª a ${grupo.ate}ª</td>
                <td style="padding:2px 4px;text-align:right;">
                  <span style="color:#e11d48;text-decoration:line-through;">
                    R$ ${grupo.valorCheio.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                  </span>
                </td>
                <td style="padding:2px 4px;text-align:right;color:#22c55e;font-weight:bold;">
                  R$ ${grupo.valorDesconto.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        <div style="font-size:0.95em;color:#aaa;margin-top:2px">*Plano progressivo: valores mudam a cada período</div>
        `;
      }

      const idCheckboxValorCheio = "mostrarValorCheioProposta";
      const resumoHTML = `
<div id="resumoProposta" style="background:#fef9c3;" class="mt-6 bg-yellow-50 border border-yellow-300 rounded-lg p-6 relative fade-in">
        <div class="absolute top-2 right-2 text-2xl" style="color:#eab308;"><i class="fas fa-certificate"></i></div>
        <h2 class="text-2xl font-bold mb-2" style="color:#111;">Resumo da Proposta</h2>
        <div class="mb-2" style="color:#111;">
            <b>Cliente:</b> ${nomeCliente} <br>
            <b>Nº Cliente:</b> ${numeroCliente} <br>
            <b>Curso:</b> ${cursoSelecionado} <br>
            <b>Turno:</b> ${turnoSelecionado} <br>
            <b>Início da turma:</b> ${resumoInicioTurma} <br>
            <b>Horário:</b> ${resumoHorario || '-'} <br>
            <b>Dias de aula:</b> ${resumoDiasAula}
        </div>
        <div class="mb-2" style="color:#111;">
            <label class="inline-flex items-center mb-1 select-none cursor-pointer">
                <input type="checkbox" id="${idCheckboxValorCheio}" class="mr-2 accent-yellow-500" onchange="toggleValorCheioResumo()" />
            </label>
            <span id="descontoTotalResumo">
                <b>Desconto total:</b> <span style="color:#15803d;font-weight:bold">R$ ${valorDescontoTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span>
            </span>
            <span class="valor-cheio-toggle" style="display:none;">
                <br>
                <b>Valor cheio:</b> <span class="valor-riscado">R$ ${valorCheio.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span>
                <br>
                <b>Com desconto:</b> <span style="color:#15803d;font-weight:bold">R$ ${valorFinal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span>
            </span>
            <br>
            <b>Desconto percentual:</b> <span style="color:#15803d;font-weight:bold">${descontoStr}%</span><br>
            ${resumoParcelamentoFixo}
            ${tabelaParcelasAgrupadaHTML}
            ${resumoAlertaProgressivo}
            <br>
            <span style="font-weight:bold; color:#444; display:inline-block; margin-top:12px;">
                ${usuarioLogado ? usuarioLogado.cargo + ': ' + usuarioLogado.nome : ''}
            </span>
        </div>
        <div class="mb-2" style="color:#111;">
            <b>Proposta válida até:</b> <span style="color:#b91c1c;font-weight:bold">${dataEncerramentoBR}</span>
        </div>
        <div class="mt-3 flex flex-col sm:flex-row gap-2">
            <button type="button" onclick="copiarResumoImagem()" class="bg-green-600 hover:bg-green-700 text-white font-semibold rounded px-4 py-2 w-full sm:w-auto transition-colors duration-200">
                <i class="fas fa-copy"></i> Copiar imagem
            </button>
            <button type="button" onclick="compartilharResumoWhatsApp()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded px-4 py-2 w-full sm:w-auto transition-colors duration-200">
                <i class="fab fa-whatsapp"></i> Compartilhar no WhatsApp
            </button>
        </div>
        <div class="text-xs" style="color:#a16207;margin-top:8px;">*Proposta válida por tempo limitado. Válida somente para o cliente informado.</div>
        <div class="flex justify-end mt-4">
            <img src="imagens/Grau.png" alt="Logo Grau Educacional" style="height:40px;width:auto;background:white;padding:4px;border-radius:6px;box-shadow:0 2px 8px #0001;">
        </div>
    </div>
`;
      lastResumoTexto = `
Cliente: ${nomeCliente}
Nº Cliente: ${numeroCliente}
Curso: ${cursoSelecionado}
Turno: ${turnoSelecionado}
Início da turma: ${resumoInicioTurma}
Horário: ${resumoHorario || '-'}
Dias de aula: ${resumoDiasAula}
Desconto total: R$ ${valorDescontoTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
Desconto percentual: ${descontoStr}%
Parcelamento fixo: ${parcelas}x de R$ ${valorParcelaDesconto.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
${usuarioLogado ? usuarioLogado.cargo + ': ' + usuarioLogado.nome : ''}
Proposta válida até: ${dataEncerramentoBR}
      `;
      lastResumoHTML = resumoHTML;
      iniciarTimer(6 * 60 * 60);
      resultadoDiv.innerHTML += resumoHTML;
    }

    function toggleValorCheioResumo() {
      var resumo = document.getElementById('resumoProposta');
      var chk = document.getElementById('mostrarValorCheioProposta');
      if (resumo && chk) {
        if (chk.checked) {
          resumo.classList.add('mostrar-valor-cheio');
          var valCheio = resumo.querySelectorAll('.valor-cheio-toggle');
          valCheio.forEach(function (el) { el.style.display = 'inline'; });
        } else {
          resumo.classList.remove('mostrar-valor-cheio');
          var valCheio = resumo.querySelectorAll('.valor-cheio-toggle');
          valCheio.forEach(function (el) { el.style.display = 'none'; });
        }
      }
    }

    function iniciarTimer(segundos) {
      const timerDiv = document.getElementById("timer");
      let tempoRestante = segundos;
      clearInterval(countdownInterval);
      atualizarTimer();
      countdownInterval = setInterval(() => {
        tempoRestante--;
        atualizarTimer();
        if (tempoRestante <= 0) {
          clearInterval(countdownInterval);
          timerDiv.innerHTML = `<i class="fas fa-hourglass-end"></i> Proposta expirada! Gere novamente para continuar.`;
          document.getElementById("resultado").innerHTML = "";
          document.getElementById("areaDesconto").innerHTML = "";
        }
      }, 1000);
      function atualizarTimer() {
        const min = Math.floor(tempoRestante / 60);
        const sec = tempoRestante % 60;
        const h = Math.floor(min / 60);
        const m = min % 60;
        let label = `<i class="fas fa-clock"></i> Tempo restante da proposta: <span class="font-bold">${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}</span>`;
        if (resumoDataFim) {
          label += `<br><span class="text-xs text-gray-500">Encerramento: ${String(resumoDataFim.getDate()).padStart(2, '0')}/${String(resumoDataFim.getMonth() + 1).padStart(2, '0')}/${resumoDataFim.getFullYear()} às ${String(resumoDataFim.getHours()).padStart(2, '0')}:${String(resumoDataFim.getMinutes()).padStart(2, '0')}</span>`;
        }
        timerDiv.innerHTML = label;
      }
    }

    function isMobile() {
      return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);
    }

    async function copiarResumoImagem(forceDownload = false) {
      let hiddenDiv = document.createElement('div');
      hiddenDiv.innerHTML = getResumoHTMLImagem();
      hiddenDiv.style.position = 'fixed';
      hiddenDiv.style.left = '-9999px';
      hiddenDiv.style.top = '0';
      hiddenDiv.style.width = '600px';
      hiddenDiv.style.zIndex = '-1';
      document.body.appendChild(hiddenDiv);

      const resumoDiv = hiddenDiv.querySelector('#resumoPropostaImagem');

      html2canvas(resumoDiv, {
        useCORS: true,
        backgroundColor: '#fff',
        scale: 2
      }).then(async function (canvas) {
        document.body.removeChild(hiddenDiv);
        canvas.toBlob(async function (blob) {
          if (forceDownload || !navigator.clipboard || !window.ClipboardItem) {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'proposta.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            alert('Imagem baixada! Agora anexe manualmente no WhatsApp.');
          } else {
            try {
              await navigator.clipboard.write([
                new window.ClipboardItem({ 'image/png': blob })
              ]);
              alert('Imagem copiada! Agora clique em "Compartilhar no WhatsApp", selecione o cliente e cole no WhatsApp Web (Ctrl+V).');
            } catch (e) {
              const baixar = confirm('Não foi possível copiar a imagem. Deseja baixar a imagem para enviar manualmente?');
              if (baixar) {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'proposta.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
              }
            }
          }
        });
      });
    }

    function compartilharResumoWhatsApp() {
      const numeroCliente = document.getElementById("numeroCliente").value.trim();
      let telefone = numeroCliente.replace(/\D/g, '');
      if (telefone.length === 11) {
        telefone = '55' + telefone;
      } else if (telefone.length === 13 && telefone.startsWith('55')) {
      } else {
        alert('Informe o número do cliente com DDD (ex: 11999999999).');
        return;
      }
      const waUrl = `https://wa.me/${telefone}`;
      if (isMobile()) {
        alert('No celular, a imagem será baixada. Agora anexe manualmente na conversa do WhatsApp.');
        copiarResumoImagem(true);
        window.open(waUrl, '_blank');
      } else {
        window.open(waUrl, '_blank');
        setTimeout(function () {
          alert('No WhatsApp Web, clique no campo de mensagem e cole a imagem (Ctrl+V). Se não copiou ainda, clique em "Copiar imagem".');
        }, 2000);
      }
    }

    function getResumoHTMLImagem() {
      let nomeCliente = document.getElementById("nomeCliente").value.trim();
      let numeroCliente = document.getElementById("numeroCliente").value.trim();
      let cursoSelecionado = document.getElementById("curso").value;
      let turnoSelecionado = document.getElementById("turno").value;
      let diasAula = resumoDiasAula || '-';
      let inicioTurma = resumoInicioTurma ? `<b>Início da turma:</b> ${resumoInicioTurma} <br>` : '';
      let horarioTurma = resumoHorario ? `<b>Horário:</b> ${resumoHorario} <br>` : '';
      let dataValidade = resumoDataFim ? `${String(resumoDataFim.getDate()).padStart(2, '0')}/${String(resumoDataFim.getMonth() + 1).padStart(2, '0')}/${resumoDataFim.getFullYear()} às ${String(resumoDataFim.getHours()).padStart(2, '0')}:${String(resumoDataFim.getMinutes()).padStart(2, '0')}` : '';
      let parcelas = resumoParcelas;
      let valorParcela = resumoValorParcela;
      let valorCheio = resumoValorCheio;
      let valorFinal = resumoValorFinal;
      let valorParcelaDesconto = Math.round((valorCheio * (1 - resumoDesconto)) / parcelas * 100) / 100;
      let descontoStr = resumoDescontoStr;
      let valorDescontoTotal = Math.round((valorCheio - valorFinal) * 100) / 100;
      let tabelaParcelasAgrupadaHTML = "";
      if (resumoParcelasAgrupadas.length > 0 && resumoPlanoProgressivoOk) {
        tabelaParcelasAgrupadaHTML = `
        <div style="margin:12px 0 4px 0;"><b>Ou Plano progressivo:</b></div>
        <table style="width:100%;margin-bottom:4px;border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:left;padding:2px 4px;">Parcelas</th>
              <th style="text-align:right;padding:2px 4px;">Valor cheio</th>
              <th style="text-align:right;padding:2px 4px;">Com desconto</th>
            </tr>
          </thead>
          <tbody>
            ${resumoParcelasAgrupadas.map(grupo => `
              <tr>
                <td style="padding:2px 4px;">${grupo.de}ª a ${grupo.ate}ª</td>
                <td style="padding:2px 4px;text-align:right;">
                  <span style="color:#e11d48;text-decoration:line-through;">
                    R$ ${grupo.valorCheio.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                  </span>
                </td>
                <td style="padding:2px 4px;text-align:right;color:#22c55e;font-weight:bold;">
                  R$ ${grupo.valorDesconto.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        <div style="font-size:0.95em;color:#aaa;margin-top:2px">*Plano progressivo: valores mudam a cada período</div>
        `;
      }
      let alerta = resumoAlertaProgressivo;
      let mostrarValCheio = false;
      try {
        mostrarValCheio = document.getElementById('mostrarValorCheioProposta') && document.getElementById('mostrarValorCheioProposta').checked;
      } catch (e) { }
      return `
      <div id="resumoPropostaImagem" style="background:#fff; color:#111; font-family:sans-serif; border-radius:12px; padding:24px; border:2px solid #fde047; width:100%; max-width:520px; box-sizing:border-box; position:relative;">
        <div style="position:absolute;top:16px;right:24px;font-size:28px;color:#facc15;"><i class="fas fa-certificate"></i></div>
        <h2 style="font-size:1.5em;font-weight:700;margin-bottom:8px;color:#111;">Resumo da Proposta</h2>
        <div style="margin-bottom:10px;color:#111;line-height:1.7;">
          <b>Cliente:</b> ${nomeCliente} <br>
          <b>Nº Cliente:</b> ${numeroCliente} <br>
          <b>Curso:</b> ${cursoSelecionado} <br>
          <b>Turno:</b> ${turnoSelecionado} <br>
          ${inicioTurma}
          ${horarioTurma}
          <b>Dias de aula:</b> ${diasAula}
        </div>
        <div style="margin-bottom:10px;">
          <span>
            <b>Desconto total:</b> <span style="color:#15803d;font-weight:bold;">R$ ${valorDescontoTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span>
          </span>
          ${mostrarValCheio ? `
          <br>
          <b>Valor cheio:</b> <span style="color:#e11d48;text-decoration:line-through;">R$ ${valorCheio.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span>
          <br>
          <b>Com desconto:</b> <span style="color:#15803d;font-weight:bold">R$ ${valorFinal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span>
          ` : ''}
          <br>
          <b>Desconto percentual:</b> <span style="color:#15803d;font-weight:bold;">${descontoStr}%</span><br>
          <div style="margin-bottom:8px;">
            <b>Parcelamento fixo:</b><br>
            <span style="color:#166534;font-weight:600">${parcelas}x</span> de <span style="color:#166534;font-weight:bold">R$ ${valorParcelaDesconto.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span> (com desconto)<br>
            <span style="font-size:0.95em;color:#666;">Valor cheio de cada parcela: <span style="text-decoration:line-through;color:#e11d48;">R$ ${valorParcela.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span></span>
          </div>
          ${tabelaParcelasAgrupadaHTML}
          ${alerta}
          <br>
          <span style="font-weight:bold; color:#444; display:inline-block; margin-top:12px;">
              ${usuarioLogado ? usuarioLogado.cargo + ': ' + usuarioLogado.nome : ''}
          </span>
        </div>
        <div style="margin-bottom:12px;color:#111;">
          <b>Proposta válida até:</b> <span style="color:#b91c1c;font-weight:bold">${dataValidade}</span>
        </div>
        <div style="font-size:0.9em;color:#a16207;margin-top:8px;">*Proposta válida por tempo limitado. Válida somente para o cliente informado.</div>
      </div>
      `;
    }

    function limparFormulario() {
      document.getElementById("formDesconto").reset();
      document.getElementById("resultado").innerHTML = "";
      document.getElementById("areaDesconto").innerHTML = "";
      document.getElementById("timer").innerHTML = "";
      clearInterval(countdownInterval);
      resumoParcelasProgressivas = [];
      resumoParcelasAgrupadas = [];
      resumoValorCheio = 0;
      resumoParcelas = 0;
      resumoValorParcela = 0;
      resumoDescontoStr = "";
      resumoValorFinal = 0;
      resumoDataFim = null;
      resumoAlertaProgressivo = "";
      resumoPlanoProgressivoOk = false;
      resumoHorario = '';
      turmaSelecionadaGlobal = null;
      document.getElementById('turmaContainer').style.display = "none";
    }
  </script>


</body>

</html>